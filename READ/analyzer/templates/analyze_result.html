{% extends "base.html" %}
{% load static %}
{% block header %}
<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
{% endblock %}
{% block contents %}
<!-- Navbar Menu  ---->
<section id="nav-bar">
    <nav class="navbar navbar-expand-lg navbar-light">
        <a class="navbar-brand" href="/.">
        <img src="{% static 'images/READ.png'%}" alt="">
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <i class="fa fa-bars"></i>
        </button>
    <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ml-auto">
        <li class="nav-item">
            <a class="nav-link" href="/">Home <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/logout">Logout</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/video">Video</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/subscribe">Subscribe</a>
        </li> 
        </ul>
    </div>
    </nav>
</section>

<br><br><br>
<script>
var reaction = '{{ reaction }}';
var obj = JSON.parse(reaction.replace(/&quot;/g,'"'));

var duration = obj.duration;
var time = obj.time;
var graph_data = new Array();

for(var i = 0; i < time.length; i++){
  switch(time[i]){
    case 0: // Concentrate
      graph_data[i] = {
        type: "stackedBar",
        color: "#87ECBB",
        toolTipContent: "{label}<b>{name}:</b> {y}",
        name: "집중 o",
        dataPoints: [{ y: 10 }]
      };
      break;
    case 1: // Don't concentrate
      graph_data[i] = {
        type: "stackedBar",
        color: "#F08080",
        toolTipContent: "{label}<b>{name}:</b> {y}",
        name: "집중 x",
        dataPoints: [{ y: 10 }]
      }
      break;
    case -1: // Detect Nothing
      graph_data[i] = {
        type: "stackedBar",
        color: "#7A7A7A",
        toolTipContent: "{label}<b>{name}:</b> {y}",
        name: "집중 x",
        dataPoints: [{ y: 10 }]
      }
      break;
    case -2: // there ins't person
      graph_data[i] = {
        type: "stackedBar",
        color: "#7A7A7A",
        toolTipContent: "{label}<b>{name}:</b> {y}",
        name: "집중 x",
        dataPoints: [{ y: 10 }]
      }
      break;
    case -3: // need to closer to camera
      graph_data[i] = {
        type: "stackedBar",
        color: "#C1C400",
        toolTipContent: "{label}<br><b>{name}:</b> {y}",
        name: "측정 불가",
        dataPoints: [{ y: 10 }]
      }
      break;
  }
}

window.onload = function () {
  var barchart = new CanvasJS.Chart("barchartContainer", {
    animationEnabled: true,
    theme: "light2", //"light1", "dark1", "dark2"
    axisY:{
      interval: 10,
      suffix: "s",
      maximum: duration*10
    },
    toolTip:{
      shared: true
    },
    data: graph_data
  });
barchart.render();


var counts = {};
var sum_counts = duration;
counts[0] = 0; counts[1] = 0;
counts[-1] = 0; counts[-2] = 0; counts[-3] = 0;
for (var i = 0; i < time.length; i++) {
		counts[time[i]] += 1;
}

for (var i = -3; i < 2; i++) {
		counts[i] = counts[i] / sum_counts * 100;
}

var piechart = new CanvasJS.Chart("piechartContainer", {
  animationEnabled: true,
  data: [{
    type: "pie",
    startAngle: 240,
    yValueFormatString: "##0.00\"%\"",
    indexLabel: "{label} {y}",
    dataPoints: [
      {y: counts[0], label: "집중도 높음"},
      {y: counts[1] + counts[-1] + counts[-2], label: "집중도 낮음"},
      {y: counts[-3], label: "측정 불가"}
    ]
  }]
});
piechart.render();
}

function toggleDataSeries(e) {
  if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
    e.dataSeries.visible = false;
  }
  else {
    e.dataSeries.visible = true;
  }
  chart.render();
}
</script>
</head>

<body>
<h3 class="title text-center">RESULT</h3>
<br>

<div id="main" style="margin-top:10px;">
	<div class="container">
    <h4 class="title text-center"><b>영상시간별 집중도</b></h4>
    <div id="barchartContainer" style="height: 370px; width: 100%;"></div>

    <br><br><br><br><br>

    <h4 class="title text-center"><b>현재영상 집중도 비율</b></h4>
    <div id="piechartContainer" style="height: 350px; width: 100%; border:2px;"></div>

    <br><br><br><br>
	</div>
</div>

<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
</body>

{% endblock %}